# =============================================
# CONFIGURAÇÕES PRINCIPAIS DO SITE FOGO NORTE
# =============================================

# Ativar rewrite engine
RewriteEngine On

# =============================================
# SEGURANÇA E HTTPS
# =============================================

# Forçar HTTPS
RewriteCond %{HTTPS} !=on
RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# Redirecionar www para sem www (ou vice-versa conforme preferência)
RewriteCond %{HTTP_HOST} ^www\.(.+)$ [NC]
RewriteRule ^ https://%1%{REQUEST_URI} [L,R=301]

# Headers de segurança
<IfModule mod_headers.c>
    # Proteção XSS
    Header always set X-Content-Type-Options nosniff
    Header always set X-XSS-Protection "1; mode=block"
    Header always set X-Frame-Options "SAMEORIGIN"
    
    # Referrer Policy
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    
    # Permissões de recursos
    Header always set Permissions-Policy "geolocation=(), microphone=(), camera=()"
</IfModule>

# =============================================
# CACHE E PERFORMANCE
# =============================================

<IfModule mod_expires.c>
    ExpiresActive On
    
    # Imagens
    ExpiresByType image/jpg "access plus 1 year"
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/webp "access plus 1 year"
    ExpiresByType image/svg+xml "access plus 1 year"
    ExpiresByType image/x-icon "access plus 1 year"
    
    # CSS e JavaScript
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType text/javascript "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
    ExpiresByType application/x-javascript "access plus 1 month"
    
    # Fontes
    ExpiresByType font/woff "access plus 1 year"
    ExpiresByType font/woff2 "access plus 1 year"
    ExpiresByType application/font-woff "access plus 1 year"
    ExpiresByType application/font-woff2 "access plus 1 year"
    
    # Documentos
    ExpiresByType application/pdf "access plus 1 year"
    ExpiresByType application/x-pdf "access plus 1 year"
    
    # HTML (cache curto para conteúdo dinâmico)
    ExpiresByType text/html "access plus 1 hour"
</IfModule>

# Compressão GZIP
<IfModule mod_deflate.c>
    # Ativar compressão para tipos específicos
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/xml
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE text/javascript
    AddOutputFilterByType DEFLATE application/xml
    AddOutputFilterByType DEFLATE application/xhtml+xml
    AddOutputFilterByType DEFLATE application/rss+xml
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/x-javascript
    AddOutputFilterByType DEFLATE application/json
    AddOutputFilterByType DEFLATE application/font-woff
    AddOutputFilterByType DEFLATE application/font-woff2
    AddOutputFilterByType DEFLATE image/svg+xml
    
    # Exceções para navegadores antigos
    BrowserMatch ^Mozilla/4 gzip-only-text/html
    BrowserMatch ^Mozilla/4\.0[678] no-gzip
    BrowserMatch \bMSIE !no-gzip !gzip-only-text/html
</IfModule>

# =============================================
# CONFIGURAÇÕES SEO E URLS
# =============================================

# Charset padrão
AddDefaultCharset UTF-8

# Prevenir listagem de diretórios
Options -Indexes

# Páginas de erro personalizadas
ErrorDocument 404 /404.html
ErrorDocument 500 /500.html

# Redirecionamentos permanentes para páginas removidas (exemplo)
# Redirect 301 /servico-antigo https://fogonorteextintores.com.br/#services

# =============================================
# PROTEÇÃO DE ARQUIVOS SENSÍVEIS
# =============================================

# Proteger arquivos de configuração
<FilesMatch "\.(htaccess|htpasswd|ini|log|sh|inc|bak)$">
    Order Allow,Deny
    Deny from all
</FilesMatch>

# Proteger arquivos do WordPress (se aplicável)
<Files "wp-config.php">
    Order Allow,Deny
    Deny from all
</Files>

# =============================================
# CONFIGURAÇÕES ESPECÍFICAS DO SITE
# =============================================

# Permitir acesso aos diretórios de imagens e PDFs
<Directory "image">
    Require all granted
</Directory>

<Directory "imageExtintores">
    Require all granted
</Directory>

<Directory "pdf">
    Require all granted
</Directory>

# Configurações para arquivos PDF
<FilesMatch "\.(pdf)$">
    Header set X-Content-Type-Options nosniff
    Header set X-Frame-Options SAMEORIGIN
</FilesMatch>

# =============================================
# OTIMIZAÇÕES PARA DISPOSITIVOS MÓVEIS
# =============================================

<IfModule mod_headers.c>
    # Cache para dispositivos móveis
    Header append Vary User-Agent
    
    # Otimizações de renderização
    Header always set Cache-Control "max-age=86400, public"
</IfModule>

# =============================================
# COMPATIBILIDADE COM CORS (se necessário para APIs)
# =============================================

<IfModule mod_headers.c>
    # Header set Access-Control-Allow-Origin "*"
    # Header set Access-Control-Allow-Methods "GET, POST, OPTIONS"
    # Header set Access-Control-Allow-Headers "Content-Type"
</IfModule>

# =============================================
# CONFIGURAÇÕES DE MÍDIA
# =============================================

# Tipos MIME para arquivos modernos
AddType application/font-woff .woff
AddType application/font-woff2 .woff2
AddType image/webp .webp
AddType image/svg+xml .svg

# =============================================
# PREVENÇÃO DE HOTLINK (opcional)
# =============================================

# RewriteCond %{HTTP_REFERER} !^$
# RewriteCond %{HTTP_REFERER} !^https://fogonorteextintores.com.br/.*$ [NC]
# RewriteCond %{HTTP_REFERER} !^https://fogonorteextintores.com.br$ [NC]
# RewriteRule \.(jpg|jpeg|png|gif|pdf)$ - [F,NC]

# =============================================
# CONFIGURAÇÕES DE LOG (para debugging)
# =============================================

# LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\"" combined
# CustomLog /var/log/apache2/access.log combined
# ErrorLog /var/log/apache2/error.log

# =============================================
# FIM DAS CONFIGURAÇÕES
# =============================================